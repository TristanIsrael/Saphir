# Contributor:
# Maintainer: Tristan IsraÃ«l <tristan.israel@icloud.com>
pkgname=saphir-gui
pkgver=2.2
pkgrel=0
pkgdesc="Saphir - Graphical User Interface"
url="https://defense.gouv.fr/"
arch="noarch"
license="MIT"
depends="psec-lib saphir-lib psec-gui-base python3 py3-pyside6 qt6-qt5compat py3-psutil py3-humanize py3-jinja2 weasyprint fontconfig freetype font-roboto"
makedepends=""
checkdepends=""
install="$pkgname.post-install"
subpackages=""
replaces=""
builddir="$srcdir/"
options="!check"  # no tests provided
giturl="https://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@github.com/TristanIsrael/saphir"
source="gui.initd"

prepare() {
    mkdir -p "$builddir"
    cd "$builddir"
    git clone "$giturl"
}

build() {    
    cd "$builddir/saphir/python/gui"
    python3 -m build
}

package() {
    cd "$builddir/saphir/python/gui/dist"
    mkdir -p "$pkgdir/usr/lib/saphir"
    tar xvzf *.tar.gz -C "$pkgdir/usr/lib/saphir"    
    cd "$pkgdir/usr/lib/saphir"
    ln -s "saphir_gui-$pkgver.$pkgrel" gui

    install -D -m755 "$srcdir"/gui.initd "$pkgdir"/etc/init.d/gui
}
