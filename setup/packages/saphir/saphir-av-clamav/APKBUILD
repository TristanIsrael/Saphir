# Contributor:
# Maintainer: Tristan IsraÃ«l <tristan.israel@icloud.com>
pkgname=saphir-av-clamav
pkgver=1.0
pkgrel=1
pkgdesc="Saphir - Clam Antivirus"
url="https://defense.gouv.fr/"
arch="noarch"
license="MIT"
depends="psec-lib saphir-lib clamav"
makedepends="freshclam"
checkdepends=""
install="$pkgname.post-install"
subpackages=""
replaces="freshclam"
builddir="$srcdir/"
options="!check"  # no tests provided
source="
av-controller.initd
"

prepare() {
    freshclam --datadir="$srcdir"
}

package() {
    install -D -m755 "$srcdir"/av-controller.initd "$pkgdir"/etc/init.d/av-controller

    install -D -m755 "$srcdir"/main.cvd "$pkgdir"/var/lib/clamav/main.cvd
    install -D -m755 "$srcdir"/bytecode.cvd "$pkgdir"/var/lib/clamav/bytecode.cvd
    install -D -m755 "$srcdir"/daily.cvd "$pkgdir"/var/lib/clamav/daily.cvd

    install -D -m644 "$srcdir"/freshclam.conf "$pkgdir"/etc/clamav/freshclam.conf
    install -D -m644 "$srcdir"/clamd.conf "$pkgdir"/etc/clamav/clamd.conf

    install -D -m755 "$srcdir"/av-controller.py "$pkgdir"/usr/lib/saphir/bin

    #install -D -m644 "$srcdir"/clamd.confd "$pkgdir"/etc/conf.d/clamd.conf"
}
